
MODEL:

SETS:

!VMS;
VMS /1..450/: VMCPU, VMBW;

!SERVERS: CPU, BANDWIDTH, ENERGY, X (ON/OFF);
SERVERS /1..480/: SCPU, SBW, SE, X, COST, AMOUNT_ALLOCS;

!ALLOCATION;
ALLOCS(VMS, SERVERS): A;

!ROUTERS: FLOW IN, ENERGY Y (ON/OFF);
ROUTERS /1..12/: RE, FIN, ROUTERS_CONSUME;

!LINKS;
LINKS(ROUTERS, ROUTERS): L, F;

ENDSETS

[OBJ] MIN = @SUM(SERVERS(J): COST(J)*X(J)) + @SUM(ROUTERS(J):FIN(J)*RE(J));

!COST SMALL SERVERS ON DATACENTER 0;
@FOR(SERVERS(J) | J #GT# 0 #AND# J #LE# 96:
COST(J)=0.044);

!COST LARGE SERVERS ON DATACENTER 0;
@FOR(SERVERS(J) | J #GT# 96 #AND# J #LE# 144:
COST(J)=0.089);

!COST HUGE SERVERS ON DATACENTER 0;
@FOR(SERVERS(J) | J #GT# 144 #AND# J #LE# 160:
COST(J)=0.355);

!COST SMALL SERVERS ON DATACENTER 1;
@FOR(SERVERS(J) | J #GT# 160 #AND# J #LE# 256:
COST(J)=0.044);

!COST LARGE SERVERS ON DATACENTER 1;
@FOR(SERVERS(J) | J #GT# 256 #AND# J #LE# 304:
COST(J)=0.089);

!COST HUGE SERVERS ON DATACENTER 1;
@FOR(SERVERS(J) | J #GT# 304 #AND# J #LE# 320:
COST(J)=0.355);

!COST SMALL SERVERS ON DATACENTER 2;
@FOR(SERVERS(J) | J #GT# 320 #AND# J #LE# 416:
COST(J)=0.044);

!COST LARGE SERVERS ON DATACENTER 2;
@FOR(SERVERS(J) | J #GT# 416 #AND# J #LE# 464:
COST(J)=0.089);

!COST HUGE SERVERS ON DATACENTER 2;
@FOR(SERVERS(J) | J #GT# 464 #AND# J #LE# 480:
COST(J)=0.355);


!AMOUNT OF VMS ALLOCATED IN SERVERS;
@FOR(SERVERS(J):
AMOUNT_ALLOCS(J) = @SUM(ALLOCS(I,J): A(I,J)));



!ALLOCATION RESTRICTIONS;
!CORES;
@FOR(SERVERS(J):
@SUM(VMS(I): A(I,J)*VMCPU(I)) <= SCPU(J));
!BANDWIDTH;
@FOR(SERVERS(J):
@SUM(VMS(I): A(I,J)*VMBW(I)) <= SBW(J));
!UNICITY;
@FOR(VMS(I):
@SUM(SERVERS(J): A(I,J)) = 1);

!FLOW RESTRICTIONS;
!FLOWS PRODUCED BY DATACENTERS;
@SUM(SERVERS(J)| J #GT# 0 #AND# J #LE# 160:
@SUM(VMS(I): A(I,J)*VMBW(I))) = F(10,1);
@SUM(SERVERS(J)| J #GT# 160 #AND# J #LE# 320:
@SUM(VMS(I): A(I,J)*VMBW(I))) = F(11,2);
@SUM(SERVERS(J)| J #GT# 320 #AND# J #LE# 480:
@SUM(VMS(I): A(I,J)*VMBW(I))) = F(12,3);


!CONSERVATION ON ROUTERS;
( F(10,1) ) - ( F(1,4)  +
 F(1,5)  +
 F(1,7) ) = 0;
( F(11,2) ) - ( F(2,6)  +
 F(2,9) ) = 0;
( F(12,3) ) - ( F(3,8)  +
 F(3,9) ) = 0;
( F(1,4) ) - ( F(4,6) ) = 0;
( F(1,5) ) - ( F(5,8) ) = 0;
( F(2,6)  +
 F(4,6) ) - ( F(6,7) ) = 0;
( F(3,8)  +
 F(5,8) ) - ( F(8,7) ) = 0;
( F(2,9)  +
 F(3,9) ) - ( F(9,7) ) = 0;



!CONSERVATION ON SINK;
@SUM(SERVERS(J):
@SUM(VMS(I): A(I,J)*VMBW(I)))  + 0.0 + 0.0 + 0.0 = F(1,7) +
F(6,7) +
F(8,7) +
F(9,7);


!LINK CAPACITY;
@FOR(LINKS(I,J):
F(I,J) <= L(I,J));


!FLOW IN FOR ROUTERS;
!1;
FIN(1) = F(10,1);
!2;
FIN(2) = F(11,2);
!3;
FIN(3) = F(12,3);
!4;
FIN(4) = F(1,4);
!5;
FIN(5) = F(1,5);
!6;
FIN(6) = F(2,6) +
F(4,6);
!7;
FIN(7) = F(1,7) +
F(6,7) +
F(8,7) +
F(9,7);
!8;
FIN(8) = F(3,8) +
F(5,8);
!9;
FIN(9) = F(2,9) +
F(3,9);

!X: SLACK;
@FOR(SERVERS(J):
@SUM(VMS(I): A(I,J)*VMBW(I)) + X(J) = SCPU(J));


@FOR(SERVERS(J):
@FOR(VMS(I): 
A(I,J) <= 1;
A(I,J) >= 0));

DATA:
VMCPU, VMBW = 4, 2;
SE = 90;

!BANDWIDTH OF SERVERS;
SBW = 


1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 

1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 

1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 
1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 
1000 1000 1000 1000 ;

C = 1;

!CPU CORES OF SERVERS ;
SCPU = 


4 4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 
8 8 8 8 8 8 8 8 8 8 8 8 
8 8 8 8 8 8 8 8 8 8 8 
8 8 8 8 8 8 8 8 8 8 8 
8 8 8 8 8 8 8 8 8 8 8 
8 8 8 
32 32 32 32 32 32 32 32 32 32 32 32 
32 32 32 32 

4 4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 
8 8 8 8 8 8 8 8 8 8 8 8 
8 8 8 8 8 8 8 8 8 8 8 
8 8 8 8 8 8 8 8 8 8 8 
8 8 8 8 8 8 8 8 8 8 8 
8 8 8 
32 32 32 32 32 32 32 32 32 32 32 32 
32 32 32 32 

4 4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 4 4 4 4 
4 4 4 4 4 4 4 
8 8 8 8 8 8 8 8 8 8 8 8 
8 8 8 8 8 8 8 8 8 8 8 
8 8 8 8 8 8 8 8 8 8 8 
8 8 8 8 8 8 8 8 8 8 8 
8 8 8 
32 32 32 32 32 32 32 32 32 32 32 32 
32 32 32 32 ;

L=300.0;
RE = 0.06;
ENDDATA

DATA:
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITE( 'Status:',@STATUS(), 
   @NEWLINE(2));

@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITE( 
      @IF( @STATUS() #EQ# 0, 'Global optimal', '**** Non-global ***'),
      ' solution found at iteration:', @FORMAT( @ITERS(), '14.14G'),
      @NEWLINE(2));

@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITE('Objective value:', @FORMAT( OBJ, '#41.7G'),
      @NEWLINE( 2));

@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITE('Variable           Value        Reduced Cost',
      @NEWLINE( 1));

!VMS /1..450/: VMCPU, VMBW;
!VMCPU;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( VMS(I): 
@NAME(VMCPU(I)), 
@FORMAT( VMCPU(I), '#16.7G'),
@FORMAT( @DUAL( VMCPU(I)), '#20.6G'), @NEWLINE(1));

!VMBW;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( VMS(I): 
@NAME(VMBW(I)), 
@FORMAT( VMBW(I), '#16.7G'),
@FORMAT( @DUAL( VMBW(I)), '#20.6G'), @NEWLINE(1));

!SERVERS /1..480/: SCPU, SBW, SE, X, COST, AMOUNT_ALLOCS;
!SCPU;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( SERVERS(I): 
@NAME(SCPU(I)), 
@FORMAT( SCPU(I), '#16.7G'),
@FORMAT( @DUAL( SCPU(I)), '#20.6G'), @NEWLINE(1));

!SBW;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( SERVERS(I): 
@NAME(SBW(I)), 
@FORMAT( SBW(I), '#16.7G'),
@FORMAT( @DUAL( SBW(I)), '#20.6G'), @NEWLINE(1));

!SE;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( SERVERS(I): 
@NAME(SE(I)), 
@FORMAT( SE(I), '#16.7G'),
@FORMAT( @DUAL( SE(I)), '#20.6G'), @NEWLINE(1));

!X;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( SERVERS(I): 
@NAME(X(I)), 
@FORMAT( X(I), '#16.7G'),
@FORMAT( @DUAL( X(I)), '#20.6G'), @NEWLINE(1));

!COST;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( SERVERS(I): 
@NAME(COST(I)), 
@FORMAT( COST(I), '#16.7G'),
@FORMAT( @DUAL( COST(I)), '#20.6G'), @NEWLINE(1));

!AMOUNT_ALLOCS;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( SERVERS(I): 
@NAME(AMOUNT_ALLOCS(I)), 
@FORMAT( AMOUNT_ALLOCS(I), '#16.7G'),
@FORMAT( @DUAL( AMOUNT_ALLOCS(I)), '#20.6G'), @NEWLINE(1));

!ALLOCS(VMS, SERVERS): A;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( ALLOCS(I,J): 
@NAME(A(I,J)), 
@FORMAT( A(I,J), '#16.7G'),
@FORMAT( @DUAL( A(I,J)), '#20.6G'), @NEWLINE(1));

!ROUTERS /1..12/: RE, FIN, Y, ROUTERS_CONSUME;
!RE;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( ROUTERS(I): 
@NAME(RE(I)), 
@FORMAT( RE(I), '#16.7G'),
@FORMAT( @DUAL( RE(I)), '#20.6G'), @NEWLINE(1));

!FIN;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( ROUTERS(I): 
@NAME(FIN(I)), 
@FORMAT( FIN(I), '#16.7G'),
@FORMAT( @DUAL( FIN(I)), '#20.6G'), @NEWLINE(1));

!LINKS(ROUTERS, ROUTERS): L, F;
!L;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( LINKS(I, J):
@NAME( L(I,J)),
@FORMAT( L(I,J), '#16.7G'),
@FORMAT( @DUAL( L(I,J)), '#20.6G'), @NEWLINE(1));

!F;
@TEXT('/home/lucio/modeloLingo_3data_160serv_450vm.lgr') = 
@WRITEFOR( LINKS(I, J):
@NAME( F(I,J)),
@FORMAT( F(I,J), '#16.7G'),
@FORMAT( @DUAL( F(I,J)), '#20.6G'), @NEWLINE(1));

ENDDATA
END
! Terse output mode;
SET TERSEO 1
! Solve the model;
GO
! Sensitivity Analisys;
!DIVERT /home/lucio/modeloLingo_3data_160serv_450vm.range
!RANGE
! Open a file;
!DIVERT /home/lucio/modeloLingo_3data_160serv_450vm.lgr
! Send solution to the file;
!SOLUTION
! Close solution file;
!RVRT
! Quit LINGO;
QUIT
